<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>

<body  data-bs-spy="scroll" data-bs-target="#nav-scroll">
<c:if test="${likeEnt eq 'y' }">
	<script>
        $(function() {
            $('.heart').toggleClass('text-danger');
//             var toggle = true;
        });
    </script>
</c:if>
<c:if test="${likeRecruit eq 'y' }">
	<script>
        $(function() {
            $('.bi-star').toggleClass('text-warning');
        });
    </script>
</c:if>
<section>
	<div class="container" data-sticky-container>

		<div class="row g-4">
			<!-- Advance Usage content START -->
			<div id="item">
				<div class="card bg-transparent">
					<!-- Article title -->
					<div class="card-header bg-transparent border-bottom py-0 px-0">
						<h3>채용 정보</h3>
					</div>
					
					<!-- Article Info -->
					<div class="card-body px-0">
						<!-- Card item START -->
						<div class="card rounded overflow-hidden shadow">
							<div class="row g-0">

								<!-- Card body -->
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">
										<!-- Title -->
										<div class="d-flex mb-2">
											<h5 class="card-title mb-0">${recruit.entNm }</h5>&nbsp;
											<button class="h6 fw-light like" id="likeEnt" style="border: solid 1px; background-color: white;">
												<i class="heart" style="font-style: normal; color: gray;">&#x2665;</i>
													관심기업
											</button>
										</div>
										<h3>${recruit.recruitTtl }</h3>
										<hr/>
										<!-- Content -->
										<!-- Info -->
										<table style="width: 100%;">
											<tr>
												<th width="20%">지원자격</th>
												<th width="30%"></th>
												<th width="20%">근무조건</th>
												<th width="30%"></th>
											</tr>
											<tr>
												<td>경력</td>
												<td>${recruit.recruitCareerCodeNm }</td>
												<td>고용형태</td>
												<td>
													<c:forEach var="hire" items="${recruit.hireCmmncdNms }">
														${hire }
													</c:forEach> 
												</td>
											</tr>
											<tr>
												<td></td>
												<td></td>
												<td>급여</td>
												<td>${recruit.recruitPay }</td> 
											</tr>
											<tr>
												<td></td>
												<td></td>
												<td>지역</td>
												<td>${recruit.cmmncdGrpCd } ${recruit.cmmncdNm1 }</td> 
											</tr>
										</table>

										
									</div>
								</div>
							</div>
						</div>
						<!-- Card item END -->

					</div>
					
				</div>
			</div>
			<!-- Advance Usage content END -->
		</div>

		<div class="col-md-12 d-flex justify-content-center">
			<button type="button" id="applyBtn" class="btn btn-primary" style="width: 200px; height: 40px;"><i class="bi bi-check-lg"></i>즉시지원</button>
			<button type="button" id="likeRecruitBtn" class="btn" style="width: 200px; height: 40px; border: solid 1px;"><i class="bi bi-star"></i>스크랩</button>
		</div>
		<br/>

		<div class="row g-4">
			<!-- Left side START -->
			<div class="col-md-2">
				<div data-sticky data-margin-top="80" data-sticky-for="576">
					<div id="nav-scroll" class="navbar" style="padding-top: 30px;">
						<nav class="nav nav-pills nav-pill-soft flex-column">
							<a class="nav-link" href="#item-1"><i class="bi bi-emoji-smile fa-fw me-2"></i>상세요강</a>
							<a class="nav-link" href="#item-2"><i class="bi bi-layers fa-fw me-2"></i>접수기간/방법</a>
							<a class="nav-link" href="#item-3"><i class="bi bi-info-circle fa-fw me-2"></i>지원자 정보</a>
							<a class="nav-link" href="#item-4"><i class="bi bi-house fa-fw me-2"></i>기업 정보</a>
							<a class="nav-link" href="#item-5"><i class="bi bi-house fa-fw me-2"></i>기업 게시판</a>
						</nav>
					</div>
				</div>
			</div>
			<!-- Left side END -->

			<!-- Right side START -->
			<div class="col-md-10">
				<div class="nav-scroll" data-bs-spy="scroll" data-bs-target="#nav-scroll" data-bs-smooth-scroll="true" tabindex="0">
					<!-- Get Started content START -->
					<div id="item-1">
						<div class="card bg-transparent">
							<!-- Article title -->
							<div class="card-header bg-transparent border-bottom py-0 px-0">
								<h3>상세요강</h3>
								<!-- Update and author -->
								<!-- <ul class="nav nav-divider mb-3">
									<li class="nav-item">Last updated: 7 months ago</li>
									<li class="nav-item">by Sam Lanson</li>
								</ul> -->
							</div>
							<!-- Article Info -->
							<div class="card-body px-0 pb-0">
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">
										<label for="boContent">${atchFile.filePath }</label>
										<textarea id="boContent" name="boContent" class="form-control" rows="14"></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Get Started content END -->

					<!-- Divider -->
					<div class="text-center h5 my-5"></div>


					<!-- Account setup content START -->
					<div id="item-2">
						<div class="card bg-transparent">
							<!-- Article title -->
							<div class="card-header bg-transparent border-bottom py-0 px-0">
								<h3>접수기간/방법</h3>
							</div>

							<!-- Article Info -->
							<div class="card-body px-0">
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">
										<div class="row">
											<div class="col-md-5" style="text-align: center;">
												<div>
													<i class="bi bi-calendar-range" style="font-size: 2em;"></i><br/>
													<span style="font-size: 1em;">남은시간</span>
												</div>
												<span id="time"></span>&nbsp;
												<span id="formatDate"></span>
												<br/>
												<p id="formatTime"></p>
											</div>
											<div class="col-md-7">
												<button type="submit" id="recruitPageBtn" class="btn btn-primary">채용페이지로 이동</button>
												<span>홈페이지 지원 클릭수 : ${recruit.recruitHit }</span><br/>
												모집분야&nbsp;&nbsp;&nbsp;<span>${recruit.pstnCmmncdNm }</span><br/>
												모집인원&nbsp;&nbsp;&nbsp;<span>${recruit.recruitCnt }명</span><br/>
												<input type="button" value="즉시 지원">
											</div>
										</div>
									</div>
								</div>
							</div>
							
							
						</div>
					</div>
					<!-- Account setup content END -->

					<!-- Divider -->
					<div class="text-center h5 my-5"></div>

					<!-- Other Topics content START -->
					<div id="item-3">
						<div class="card bg-transparent">
							<!-- Article title -->
							<div class="card-header bg-transparent border-bottom py-0 px-0">
								<h3>지원자 정보</h3>
							</div>

							<!-- Article Info -->
							<div class="card-body px-0">
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">
										<div class="row">
											<div class="col-md-4">
												<table width="100%;">
													<span style="font-size: 18px;">학교</span><hr/>
													<tr>
														<td width="20%">1위</td>
														<td width="60%">학교명</td>
														<td width="20%">1.8%</td>
													</tr>
													<tr>
														<td>2위</td>
														<td>학교명</td>
														<td>1.8%</td>
													</tr>
													<tr>
														<td>3위</td>
														<td>학교명</td>
														<td>1.8%</td>
													</tr>
													<tr>
														<td>4위</td>
														<td>학교명</td>
														<td>1.8%</td>
													</tr>
													<tr>
														<td>5위</td>
														<td>학교명</td>
														<td>1.8%</td>
													</tr>
												</table>
											</div>


											<div class="col-md-4">
												<table width="100%;">
													<span style="font-size: 18px;">전공</span><hr/>
													<tr>
														<td width="20%">1위</td>
														<td width="60%">학과</td>
														<td width="20%">30.8%</td>
													</tr>
													<tr>
														<td>2위</td>
														<td>학과</td>
														<td>25.8%</td>
													</tr>
													<tr>
														<td>3위</td>
														<td>학과</td>
														<td>22.8%</td>
													</tr>
													<tr>
														<td>4위</td>
														<td>학과</td>
														<td>12.8%</td>
													</tr>
													<tr>
														<td>5위</td>
														<td>학과</td>
														<td>11.8%</td>
													</tr>
												</table>
											</div>

											<!-- 크기조절실패 -->
											<div class="col-md-4" style="position: relative;">
												<span style="font-size: 18px;">성별</span><hr/>
												<!-- <div id="ChartPageViews" style="min-height: 100px; width: 300px;"></div> -->
												<div class="mb-3 mb-xl-0 d-flex justify-content-center" id="apexChartPageViews">
													
												</div>
											</div>
											
										</div>
									</div>
								</div>
							</div>
							
						</div>
					</div>
					<!-- Other Topics content END -->

					<!-- Divider -->
					<div class="text-center h5 my-5"></div>

					<!-- Advance Usage content START -->
					<div id="item-4">
						<div class="card bg-transparent">
							<!-- Article title -->
							<div class="card-header bg-transparent border-bottom py-0 px-0">
								<h3>기업 정보</h3>
							</div>

							<!-- Article Info -->
							<div class="card-body px-0">
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">

										<!-- Card item START -->
										<div class="card rounded overflow-hidden shadow">
											<div class="row g-0">

												<!-- Image -->
												<div class="col-md-3">
													<img src="/main/logodisplay?entNo=${recruit.entNo }" alt="logo" style="height: 150px; width: 150px">
												</div>
												
												<!-- Card body -->
												<div class="col-md-9">
													<div class="card-body">
														<!-- Title -->
														<div class="d-flex mb-2" style="display: flex; align-items: baseline;">
															<h5 class="card-title mb-0"><a href="#">ITcruit</a></h5>
															&nbsp;
															<button onclick="window.location.href='/ent/detail.do?entNo=${recruit.entNo }'" class="h6 fw-light" style="height: 30px; border: solid 1px; background-color: white;"><span>기업정보</span></button>
															&nbsp;
															<!-- Wishlist icon -->
															<button class="h6 fw-light like" id="likeBtn" style="height: 30px; border: solid 1px; background-color: white;"><i class="heart" style="font-style: normal; color: gray;">&#x2665;</i>${enterprise.entHit } 관심기업</button>
														</div>
														<!-- Content -->
														<!-- Info -->
														<table width="100%">
															<tr>
																<td>산업</td>
																<td>${enterprise.ksicNm }</td>
																<td>사원수</td>
																<td>${enterprise.empCnt }명</td>
															</tr>
															<tr>
																<td>설립</td>
																<td>${enterprise.fndnYr }1981년(44년차)</td>
																<td>기업형태</td>
																<td>${enterprise.bizTypeNm }</td>
															</tr>
															<tr>
																<td>매출액</td>
																<td>${enterprise.entEbit }</td>
															</tr>
														</table>

													</div>
												</div>
											</div>
										</div>
										<!-- Card item END -->

									</div>
								</div>
							</div>
							
						</div>
					</div>
					<!-- Advance Usage content END -->

					<!-- Divider -->
					<div class="text-center h5 my-5"></div>

					<div id="item-5">
						<div class="card bg-transparent">
							<!-- Article title -->
							<div class="card-header bg-transparent border-bottom py-0 px-0" style="display: flex; justify-content: space-between; align-items: flex-end;">
								<h3>기업 게시판</h3><a href=""><span>게시판 더보기<i class="bi bi-chevron-right"></i></span></a>
							</div>
							<!-- Article Info -->
							<div class="card-body px-0">
								<div class="col-md-12" style="border: 1px solid #6F5CF3;">
									<div class="card-body">
										<table width="100%">
											<tr>
												<td><a href=""><h4>[공지] KT 대졸 신입 채용 시작</h4></a></td>
											</tr>
											<tr>
												<td><h5>KT 대졸 신입 채용을 시작했습니다</h5></td>
											</tr>
											<tr>
												<td>
													<i class="bi bi-eye"></i>조회수&nbsp;&nbsp;
													<i class="bi bi-chat-left"></i>댓글수&nbsp;&nbsp;
													등록일(2024.04.04)
												</td>
											</tr>
										</table>
										<br/><hr/>
										<table width="100%">
											<tr>
												<td><a href=""><h4><i class="bi bi-question-lg" style="color: #6F5CF3;"></i>직무 PT,창의면접 대비</h4></a></td>
											</tr>
											<tr>
												<td><h5>KT 직무 PT 대비하느라 전공과정을 리뷰하고 있는데 좀 딥하게 파고...</h5></td>
											</tr>
											<tr>
												<td>
													<i class="bi bi-eye"></i>조회수&nbsp;&nbsp;
													<i class="bi bi-chat-left"></i>댓글수&nbsp;&nbsp;
													등록일(2024.04.04)
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
							
							
						</div>
					</div>

				<!-- Divider -->
				<div class="text-center h5 my-5"></div>

				</div>
			</div>
			<!-- Right side END -->
		</div>
	</div>
</section>
</body>

<script src="${pageContext.request.contextPath }/resources/assets/vendor/apexcharts/js/apexcharts.min.js"></script>
<script src="${pageContext.request.contextPath }/resources/assets/vendor/sticky-js/sticky.min.js"></script>
<script type="text/javascript">
$(function(){
	// 관심기업 버튼클릭 이벤트
    var accountId = "${recruit.accountId }";
    var entNo = ${recruit.entNo };
    var recruitNo = "${recruit.recruitNo }";
    
    var obj = {
    	accountId : accountId,
    	entNo : entNo
    }
    
    $('.like').click(function(){
    	
    	var num = parseInt($(this).text());
    	
    	if($('.heart').hasClass('text-danger')){
    		
    		$.ajax({
            	type : "post",
            	url : "/like/hateEnt.do",
            	contentType : "application/json; charset=utf-8",
            	data : JSON.stringify(obj),
            	beforeSend: function(xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success : function(result){
                	console.log(result);
                	if(result.likeEntYN == "Y"){
                		$('.heart').removeClass('text-danger');
                		$("#likeBtn").html('<i class="heart" style="font-style: normal; color: gray;">&#x2665;</i>' + result.entHit + " 관심기업");
                		console.log("result.entHit");
	                	alert("관심기업 등록취소");
// 	                	updateHit(result.entHit);
                	}else{
                		alert("관심기업 등록취소 실패");
                	}
                }
                
            });
    		
    	}else{
    		
    		$.ajax({
            	type : "post",
            	url : "/like/loveEnt.do",
            	contentType : "application/json; charset=utf-8",
            	data : JSON.stringify(obj),
            	beforeSend: function(xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success : function(result){
                	console.log(result);
                	if(result.likeEntYN == "Y"){
                		$('.heart').addClass('text-danger');
                		$("#likeBtn").html('<i class="heart text-danger" style="font-style: normal; color: gray;">&#x2665;</i>' + result.entHit + " 관심기업");
                		console.log("result.entHit");
                		alert("관심기업 등록성공");
//                 		updateHit(result.entHit);
                	}else{
                		alert("관심기업 등록실패");
                	}
                }
                
            });
    	}
    });

    
    var applyBtn = $("#applyBtn");
    
    // 지원버튼 이벤트
    applyBtn.on("click", function(){
    	
    	
        console.log(accountId);
        console.log(recruitNo);
        
        if(accountId == null || accountId == ""){
        	alert("회원가입후 이용");
        	location.href = "/account/member/signup.do";
        }
        
        
        var obj = {
        	accountId : accountId,
        	recruitNo : recruitNo
        }
    	
        $.ajax({
        	type : "post",
        	url : "/like/apply.do",
        	contentType : "application/json; charset=utf-8",
        	data : JSON.stringify(obj),
        	beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success : function(result){
            	console.log(result);
            	
            	var processYn = result.processYn;
            	var entUrl = result.entUrl;
            	console.log(entUrl);
            	
            	if(processYn == "Y"){
            		console.log("프로세스진행");
            	}else{
            		if (!entUrl.startsWith("http://") && !entUrl.startsWith("https://")) {
            	        // 상대 URL인 경우, 절대 URL로 변환
            	        entUrl = "http://" + entUrl;
            	    }
            	    window.open(entUrl, "_blank");
            	}
            }
            
        });
        
    });
    
    var likeRecruitBtn = $("#likeRecruitBtn");
    
    likeRecruitBtn.on("click", function(){
    	
        var obj = {
          	accountId : accountId,
        	recruitNo : recruitNo
        }
        
       	if($('.bi-star').hasClass('text-warning')){
       		
       		$.ajax({
               	type : "post",
               	url : "/like/hateRecruit.do",
               	contentType : "application/json; charset=utf-8",
               	data : JSON.stringify(obj),
               	beforeSend: function(xhr) {
                       xhr.setRequestHeader(header, token);
                   },
                   success : function(result){
                   	console.log("!!!!" + result);
                   	if(result == "Y"){
                   		 $('.bi-star').removeClass('text-warning');
                   		
   	                	alert("관심공고 등록취소");
                   	}else{
                   		alert("관심공고 등록취소 실패");
                   	}
                   }
                   
               });
       		
       	}else{
       		
       		$.ajax({
               	type : "post",
               	url : "/like/loveRecruit.do",
               	contentType : "application/json; charset=utf-8",
               	data : JSON.stringify(obj),
               	beforeSend: function(xhr) {
                       xhr.setRequestHeader(header, token);
                   },
                   success : function(result){
                   	console.log("!!!!" + result);
                   	if(result == "Y"){
                   		$('.bi-star').addClass('text-warning');
                   		alert("관심공고 등록성공");
                   	}else{
                   		alert("관심공고 등록실패");
                   	}
                }
               
            });
       	}
    	
    });
    
    
    
    var recruitPageBtn = $("#recruitPageBtn");
    recruitPageBtn.on("click", function(){
	
    	console.log(accountId);
    	if(accountId == null || accountId == ""){
    		
    	}
    	
    });
    
});



// 남은시간표시
function timer(){
	var endTime = new Date("${recruit.recruitEndDt }");
    var currentTime = new Date();
    
    var time = endTime - currentTime;
    
    // 타입에 맞게 저장
    var days = Math.floor(time / (1000 * 60 * 60 * 24));
    var hours = Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((time % (1000 * 60)) / 1000);
    
    // 9을 09로 출력
    var daysStr = days < 10 ? "0" + days : days;
    var hoursStr = hours < 10 ? "0" + hours : hours;
    var minutesStr = minutes < 10 ? "0" + minutes : minutes;
    var secondsStr = seconds < 10 ? "0" + seconds : seconds;
    
	var timeHTML = "<span style='color: red; font-size: 1.3em;'>" + daysStr + "일</span>&nbsp;";
	timeHTML += "<span style='color: red; font-size: 1.3em;'>" + hoursStr + ":" + minutesStr + ":" + secondsStr + "(시간)</span><br/>";

	document.getElementById("time").innerHTML = timeHTML;
}

timer();
	
setInterval(timer, 1000);

// 시작일,마감일 변경
function formatDate(dateString) {
    var date = new Date(dateString);
    var year = date.getFullYear();
    var month = date.getMonth() + 1; 
    var day = date.getDate();

    month = month < 10 ? "0" + month : month;
    day = day < 10 ? "0" + day : day;

    // 요일 구하기
    var days = ['일', '월', '화', '수', '목', '금', '토'];
    var dayOfWeek = days[date.getDay()];

    return year + "." + month + "." + day + "(" + dayOfWeek + ")";
}
var startDate = "${recruit.recruitStrtDt}";
var formatStartDate = formatDate(startDate);
var endDate = "${recruit.recruitEndDt}";
var formatEndDate = formatDate(endDate);
var dateHTML = "시작일&nbsp;&nbsp;<span style='font-weight: bold;'>" + formatStartDate + "</span><br/>";
dateHTML += "마감일&nbsp;&nbsp;<span style='font-weight: bold;'>" + formatEndDate + "</span><br/>";
document.getElementById("formatDate").innerHTML = dateHTML;

// 마감시간 변경
var endHours = "${recruit.recruitEndDt}";
var indexT = endHours.indexOf('T'); 
var endTime = endHours.substring(indexT + 1); 
var formatEndTime = endTime.replace(':', '시 ') + '분 마감';
var timeHTML = "<p>" + formatEndTime + "</p>";
document.getElementById("formatTime").innerHTML = timeHTML;

</script>
