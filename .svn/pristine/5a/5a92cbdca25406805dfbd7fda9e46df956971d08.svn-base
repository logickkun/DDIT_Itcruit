<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<div class="page-content-wrapper border">

		<!-- Title -->
		<div class="d-flex justify-content-flex-start mb-3" style="width: 50%;">
		<span class="h3 me-5">채용 공고 통계</span> 
		<select class="form-select" aria-label="Default select example" id="tabSelect" style="width: 50%;">
			<c:forEach items="${recruitList}" var="recruit">
				<option value="#tab-2-1" data-pstnCmmncdNm="${recruit.pstnCmmncdNm}" data-recruitNo="${recruit.recruitNo}">${recruit.recruitTtl}</option>
			</c:forEach>
		</select>
		</div>


		<div class="wrapper">

        <div class="container-fluid mt-15">

            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4">

                <div class="col">
                    <div class="card mb-15">
                        <div class="card-body">
                            <span class="badge bg-success float-right">조회수</span>
                            <h3 class="mb-10">120,160,001</h3>
                            <p class="text-muted mb-0">Total: 1,5B
                                <span class="float-right"> <i class="fas fa-angle-up text-success"></i> 5.5%</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card mb-15">
                        <div class="card-body">
                            <span class="badge bg-success float-right">지원자수</span>
                            <h3 class="mb-10">100,007</h3>
                            <p class="text-muted mb-0">Total: 150M
                                <span class="float-right"> <i class="fas fa-angle-up text-success"></i> 5.5%</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card mb-15">
                        <div class="card-body">
                            <span class="badge bg-success float-right">채용합격자수</span>
                            <h3 class="mb-10">1,234</h3>
                            <p class="text-muted mb-0">Total: 329,890
                                <span class="float-right"> <i class="fas fa-angle-up text-success"></i> 5.5%</span>
                            </p>

                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card mb-15">
                        <div class="card-body">
                            <span class="badge bg-success float-right">경력/신입수</span>
                            <h3 class="mb-10">$89,909</h3>
                            <p class="text-muted mb-0">Total: $890,789
                                <span class="float-right"> <i class="fas fa-angle-up text-success"></i> 5.5%</span>
                            </p>

                        </div>
                    </div>
                </div>

            </div>


            <div class="row">
                <div class="col-lg-8 col-12">

                    <div class="card mb-15">
                        <div class="card-body">
                            <div style="height: 400px; max-width: 100%;" id="hl-line-main"></div>
                        </div>
                    </div>
					      <div id="area-container" style="width: 100%; height: 300px;">
					      
					      
					      </div>
                </div>

                <div class="col-lg-4 col-12">

                    <div class="card mb-15">

                        <div class="card-body">

                            <div class="mb-15">
                                <div style="height: 280px; max-width: 100%;" id="hl-pie-ref"></div>
                            </div>
							<div class="progress progress-xs mt-5">
                                    <div class="progress-bar" style="width: 30.5%;"></div>
                            </div>
                            <div class="mb-15">
                                <a href="https://www.google.com" class="text-body">고등학교 졸업</a>
                                <div class="float-right text-muted">
                                    30.5%
                                </div>
                                <div class="progress progress-xs mt-5">
                                    <div class="progress-bar" style="width: 30.5%;"></div>
                                </div>
                            </div>

                            <div class="mb-15">
                                <a href="https://www.twitter.com" class="text-body">초대졸(2년)</a>
                                <div class="float-right text-muted">
                                    25.5%
                                </div>
                                <div class="progress progress-xs mt-5">
                                    <div class="progress-bar" style="width: 25.5%;"></div>
                                </div>
                            </div>

                            <div class="mb-15">
                                <a href="https://morioh.com" class="text-body">대졸(4년)</a>
                                <div class="float-right text-muted">
                                    16%
                                </div>

                                <div class="progress progress-xs mt-5">
                                    <div class="progress-bar" style="width: 16%;"></div>
                                </div>
                            </div>


                            <div class="mb-15">
                                <a href="https://facebook.com" class="text-body">대졸(석/박사)</a>
                                <div class="float-right text-muted">
                                    8%
                                </div>
                                
                            </div>



                        </div>

                    </div>

                </div>
            </div>

            

        </div>

    </div>
 </div>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>
	<script src="https://code.highcharts.com/modules/accessibility.js"></script>
	
 <script>
 $(function(){  
   
   // Line 그래프 
   Highcharts.chart('hl-line-main', {
       chart: {
           type: 'line'
       },
       title: {
           text: '채용 공고 통계'
       },
       xAxis: {
           categories: ['1일', '2일', '3일', '4일', '5일', '6일', '7일', '8일', '9일', '10일', '11일', '12일']
       },
       yAxis: {
           title: {
               text: '5월'
           }
       },
       plotOptions: {
           line: {
               dataLabels: {
                   enabled: true
               },
               enableMouseTracking: false
           }
       },
       series: [{
           name: '조회수',
           data: [16.0, 18.2, 23.1, 27.9, 32.2, 36.4, 39.8, 38.4, 35.5, 29.2,
               22.0, 17.8]
       }, {
           name: '지원자수',
           data: [5.0, 7.2, 3.4, 4.8, 10.2, 14.5, 17.6, 16.5, 12.0, 6.5,
               2.0, 1.0]
       }, {
           name: '채용합격자수',
           data: [12.1, 5.5, 8.1, 4.8, 10.2, 14.5, 17.6, 16.5, 12.0, 6.5,
               2.0, 1.0]
       }, {
           name: '경력/신입수',
           data: [4.7, 8.3, 7.2, 4.8, 10.2, 14.5, 17.6, 16.5, 12.0, 6.5,
               2.0, 1.0]
       }
       
       ]
   });
   
   /////원 그래프
   (function (H) {
   H.seriesTypes.pie.prototype.animate = function (init) {
       const series = this,
           chart = series.chart,
           points = series.points,
           {
               animation
           } = series.options,
           {
               startAngleRad
           } = series;

       function fanAnimate(point, startAngleRad) {
           const graphic = point.graphic,
               args = point.shapeArgs;

           if (graphic && args) {

               graphic
                   // Set inital animation values
                   .attr({
                       start: startAngleRad,
                       end: startAngleRad,
                       opacity: 1
                   })
                   // Animate to the final position
                   .animate({
                       start: args.start,
                       end: args.end
                   }, {
                       duration: animation.duration / points.length
                   }, function () {
                       // On complete, start animating the next point
                       if (points[point.index + 1]) {
                           fanAnimate(points[point.index + 1], args.end);
                       }
                       // On the last point, fade in the data labels, then
                       // apply the inner size
                       if (point.index === series.points.length - 1) {
                           series.dataLabelsGroup.animate({
                               opacity: 1
                           },
                           void 0,
                           function () {
                               points.forEach(point => {
                                   point.opacity = 1;
                               });
                               series.update({
                                   enableMouseTracking: true
                               }, false);
                               chart.update({
                                   plotOptions: {
                                       pie: {
                                           innerSize: '40%',
                                           borderRadius: 8
                                       }
                                   }
                               });
                           });
                       }
                   });
           }
       }

       if (init) {
           // Hide points on init
           points.forEach(point => {
               point.opacity = 0;
           });
       } else {
           fanAnimate(points[0], startAngleRad);
       }
   };
}(Highcharts));

Highcharts.chart('hl-pie-ref', {
    chart: {
        type: 'pie'
    },
    title: {
        text: '고졸 / 대졸자 비율',
        align: 'left'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    accessibility: {
        point: {
            valueSuffix: '%'
        }
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            borderWidth: 2,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b><br>{point.percentage}%',
                distance: 20
            }
        }
    },
    series: [{
        // Disable mouse tracking on load, enable after custom animation
        enableMouseTracking: false,
        animation: {
            duration: 2000
        },
        colorByPoint: true,
        data: [{
            name: '고등학교 졸업',
            y: 21.3
        }, {
            name: '대학교 (2년)',
            y: 18.7
        }, {
            name: '대학교 (4년)',
            y: 20.2
        }, {
            name: '대학교 석사',
            y: 14.2
        }, {
            name: '대학교 박사',
            y: 25.6
        }]
    }]
});
//////

Highcharts.chart('area-container', {
    chart: {
        type: 'area'
    },
    title: {
        text: '지원 성별 추이'
    },
    legend: {
        layout: 'vertical',
        align: 'left',
        verticalAlign: 'top',
        x: 150,
        y: 60,
        floating: true,
        borderWidth: 1,
        backgroundColor:
            Highcharts.defaultOptions.legend.backgroundColor || '#FFFFFF'
    },
       xAxis: {
       	categories: ['1일', '2일', '3일', '4일', '5일', '6일', '7일', '8일', '9일', '10일', '11일', '12일']
       },
    yAxis: {
        title: {
            text: '성별 수'
        }
    },
    credits: {
        enabled: false
    },
    series: [{
        name: '남자',
        data: [10, 9, 11, 11, 8, 13, 12, 14, 4, 6, 2, 2]
    }, {
        name: '여자',
        data: [13, 9, 10, 10, 8, 5, 8, 6, 4, 2, 1, 5]
    }]
});


var tabSelect = $("#tabSelect");
var recruitNo = tabSelect.find("option:selected").data("recruitno");
var pstnCmmncdNm = tabSelect.find("option:selected").data("pstncmmncdnm");
console.log(recruitNo, pstnCmmncdNm);


tabSelect.on("change", function(){
	
// 	console.log(recruitNo);
	
	getRecruitApply('240502_57', '웹백엔드', 5);
	
});

function getRecruitApply(recruitNo, pstnCmmncdNm, month) {
	
	$.ajax({
		
		url : "/myPage/enterprise/getRecruitApply",
		method : "GET",
		data : { recruitNo : recruitNo, pstnCmmncdNm : pstnCmmncdNm },
		success : function(res){
			
			
// 			applicantStat(res.applyDateStat, month);


			console.log(res.applyCareerStat);
// 			console.log(res.applyGenderStat);
// 			console.log(res.applyEduStat);



// 			console.log(res.applyPassStat.length);
// 			console.log(applicantStat(res.applyDateStat, month));
// 			console.log(applicantHitStat(res.applyHitStat, month));
			
		}
	
	})
	
}


function applicantStat(applyDateStat, month){
	
	var applyCounts = {};
	var dateMonth = month - 1;
// 	console.log(applyDateStat);


	applyDateStat.forEach(app => {
		var date = new Date(app.applyDt)
// 		console.log(date);
		var appMonth = date.getUTCMonth();
		
		if(appMonth === dateMonth){
			
			var formatDate = date.toISOString().substring(0, 10);
			if(counts[formatDate]) {
				
				counts[formatDate]++;
				
			}else{
				
				counts[formatDate] = 1;
				
			}
			
		}
		
		
	});
	
	return applyCounts;

}

function applicantHitStat(applyHitStat, month) {
	
	var hitCounts = {};
	var dateMonth = month - 1;
	
// 	console.log(applyHitStat);
	
	applyHitStat.forEach(app => {
		
		var date = new Date(app.logDate)
		var appMonth = date.getUTCMonth();
		
		
		if(appMonth === dateMonth) {
			
			var formatDate = date.toISOString().substring(0, 10);
			hitCounts[formatDate] = app.increaseCount;
				
			
		}
		
		
	});

	
	return hitCounts;
}



	
	
});

</script>
