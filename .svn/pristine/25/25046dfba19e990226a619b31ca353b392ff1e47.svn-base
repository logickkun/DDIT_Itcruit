<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>

<!-- Page main content START -->
<div class="page-content-wrapper border">
    <!-- Title -->
    <div class="row mb-3">
        <div class="col-12 d-sm-flex justify-content-between align-items-center">
            <h1 class="h3 mb-2 mb-sm-0">관심기업</h1>
        </div>
    </div>

    <!-- Courses Row START -->
    <div class="row g-4">
        <!-- Course information START -->
        <div class="col-lg-6">
            <div class="card bg-transparent border rounded-3 h-100">
                <div class="card-header bg-light border-bottom">
                    <h5 class="card-header-title">기업 목록</h5>
                </div>
                					<!-- Card body START -->
					<div class="card-body pb-0">
						<!-- Table START -->
						<div class="table-responsive border-0">
							<c:set value="${likeEntPagingVO.dataList }" var="entList"/>
							<table class="table align-middle p-4 mb-0 table-hover" style="text-align: center;">
								<thead style="background-color: #DCD8FC;">
									<tr>
										<th scope="col" class="col-4 rounded-start">기업명</th> <!-- 폭 줄임 -->
										<th scope="col" class="col-4 rounded-end">관심기업 해제</th> <!-- 폭 줄임 -->
									</tr>
								</thead>
								<c:choose>
								<c:when test="${empty entList }">
									<tr>
										<td colspan='4'> <span>관심 기업이 등록되지 않았습니다</span> </td>
									</tr>
								</c:when>
								<c:otherwise>
									<tbody>
										<c:forEach items="${entList }" var="entList">
											<!-- Table row -->
											<tr>
												<!-- Table data -->
												<td> <a href="#" class="selectEnt" data-entno=${entList.entNo } style="color: gray; text-decoration: none;" onmouseover="this.style.color='#3399FF';" onmouseout="this.style.color='gray';"> <span style="font-weight: bold;"> ${entList.entNm } </span> </a></td>
												<!-- Table data -->
												<td>
													<button class="btn btn-sm btn-danger mb-0 deleteBtn"
														data-entno=${entList.entNo }>해제</button>
												</td>
											</tr>
										</c:forEach>
									</tbody>
								</c:otherwise>
							</c:choose>
							</table>
						</div>
						<!-- Table END -->
						<form method="post" id="likeEntListForm">
							<input type="hidden" id="likeEntListPage" name="likeEntListPage">
							<sec:csrfInput/>
						</form>
						<div id="likeEntListPagingArea" class="d-sm-flex justify-content-sm-between align-items-sm-center mt-1 mt-sm-0">
						<p class="mb-0 text-center text-sm-start"></p>
						${likeEntPagingVO.pagingHTML }
						</div>
					</div>
					<!-- Card body END -->
            </div>
        </div>
        <!-- Course information START -->
        <div class="col-lg-6">
            <div class="card bg-transparent border rounded-3 h-100">
                <div class="card-header bg-light border-bottom">
                    <h5 class="card-header-title">기업정보</h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                           <a id="detail"> <img id="entImg" src="#" class="rounded" alt=""> </a>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <ul class="list-group list-group-borderless">
                                <li class="list-group-item"> <span id="tksdjq"></span> <span class="h6 mb-0" id="ksicNm"></span></li>
                                <li class="list-group-item"> <span id="rldjqrnqns"></span> <span class="h6 mb-0" id="bizTypeNm"></span></li>
                                <li class="list-group-item"><span id="wkqhsrma"></span><span class="h6 mb-0" id="cptl"></span></li>
                                <li class="list-group-item"><span  id="eovy"></span><span class="h6 mb-0" id="rprsvNm"></span></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-group list-group-borderless">
                                <li class="list-group-item"><span id="tkdnjstn"></span> <span class="h6 mb-0" id="entCnt"></span></li>
                                <li class="list-group-item"><span id="tjfflqdlf"></span> <span class="h6 mb-0" id="fndnYr"></span></li>
                                <li class="list-group-item"><span id="wjssusaocnf"></span> <span class="h6 mb-0" id="entSlsAmt"></span></li>
                                <li class="list-group-item"><span id="wnth"></span> <span class="h6 mb-0" id="address"></span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Course information END -->
    </div>
    <!-- Courses Row END -->
</div>


<script type="text/javascript">
$(function(){
	
	
	var likeEntListPagingArea = $("#likeEntListPagingArea");
	var likeEntListForm = $("#likeEntListForm");
	
	likeEntListPagingArea.on("click", "a" ,function(e){
		e.preventDefault();
		var likeEntListPagingNo = $(this).data("recruitminipage");
		likeEntListForm.find("#likeEntListPage").val(likeEntListPagingNo);
		likeEntListForm.submit();
	})
	
	
	$('.deleteBtn').on("click",function(){
		
		var entNo = $(this).data("entno")
		
		var deleteBtn = $(this);
		
		console.log(entNo);
		
		Swal.fire({
			title: "관심 기업를 해지하시겠습니까?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '확인',
            cancelButtonText: '취소',
            reverseButtons: false
		}).then((result) => {
			
			$.ajax({
				url : "/myPage/member/deleteEnt.do",
				type : "post",
				data : {
					entNo : entNo 
				},
				beforeSend : function(xhr){
					xhr.setRequestHeader(header,token);
				},
				success : function(res){
					deleteBtn.closest("tr").remove();
				}
				
			});
		})
	});

	

		
		

	
	$(".selectEnt").on("click",function(e){
		e.preventDefault();
		
		var entNo = $(this).data("entno");
		

		
		$.ajax({
			type : "post",
			url : "/ent/modalDetail.do",
			data : {
				entNo : entNo
			},
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
			success : function(res) {
				console.log(res);
				
				console.log("ㅇㅁㄴㅇㅁㄴㅇㅁㄴㅇㅁㅇㅁㄴㅇㅁㅇㅁㄴㅇㅁㄴㅇ");

				$("#entNo").val(res.entVO.entNo);
				$("#entImg").attr("src", "/main/logodisplay?entNo=" + res.entVO.entNo);
				$("#detail").attr("href","/ent/detail.do?entNo=" + res.entVO.entNo);

				
				
				$("#tksdjq").text("산업");
				$("#rldjqrnqns").text("기업구분");
				$("#wkqhsrma").text("자본금");
				$("#eovy").text("대표");
				$("#tkdnjstn").text("사원수");
				$("#tjfflqdlf").text("설립일");
				$("#wjssusaocnf").text("전년매출");
				$("#wnth").text("주소");
				
				
				
				$("#ksicNm").text(res.entVO.ksicNm); // 산업	
		        $("#entCnt").text(res.entVO.empCnt + " 명"); // 사원수
		        $("#bizTypeNm").text(res.entVO.bizTypeNm); // 기업구분
		     	
		        // 날짜 문자열 추출
		        var dateString = res.entVO.fndnYr;

		        // 날짜 형식으로 변환
		        var dateObject = new Date(dateString.substring(0, 4), // 연도
		                                  dateString.substring(4, 6) - 1, // 월 (0부터 시작하므로 -1)
		                                  dateString.substring(6, 8)); // 일

		        // 날짜를 원하는 형식으로 형식화
		        var formattedDate = dateObject.getFullYear() + '-' + ('0' + (dateObject.getMonth() + 1)).slice(-2) + '-' + ('0' + dateObject.getDate()).slice(-2);

		        // 결과를 출력
		        $("#fndnYr").text(formattedDate);
		        
		        // 3자리마다 ,를 찍기위한 작업
		        var number = res.entVO.cptl; // 자본금
		        var cptl = number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); 
		        $("#cptl").text(cptl + " 원");
		        
		        var number1 = res.entVO.entSlsAmt;
		        var entSlsAmt = number1.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		        $("#entSlsAmt").text(entSlsAmt + " 원"); // 전년매출
		        $("#rprsvNm").text(res.entVO.rprsvNm); // 대표
		        $("#address").text(res.entVO.accountAddr1 +  res.entVO.accountAddr2); // 주소
			}
		})
	});
	
	





});

</script>