package kr.co.itcruit.enterprise.like.controller;

import javax.inject.Inject;
import javax.servlet.http.HttpSession;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import kr.co.itcruit.ServiceResult;
import kr.co.itcruit.enterprise.like.service.ILikeService;
import kr.co.itcruit.vo.EnterpriseVO;
import kr.co.itcruit.vo.RecruitVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/like")
public class LikeController {
	
//	기업 / 채용 좋아요 눌렀을 경우 이놈이 일함
	
	@Inject
	private ILikeService likeService;
	//1. 관심기업추가
	//2. 관심채용추가
	
	// 관심기업 추가
	@RequestMapping(value = "/loveEnt.do", method = RequestMethod.POST)
	public ResponseEntity<EnterpriseVO> loveEnt(@RequestBody EnterpriseVO enterpriseVO,
			Model model) {
		
//		log.info(enterpriseVO.toString());
		ServiceResult result = likeService.loveEnt(enterpriseVO);
		String yn = "";
		
		int num = likeService.countLikeEnt(enterpriseVO);
		
		if(result.equals(ServiceResult.OK)) {
			yn = "Y";
		}else {
			yn = "N";
		}
			
		enterpriseVO.setEntHit(num);
		enterpriseVO.setLikeEntYN(yn);
		return new ResponseEntity<EnterpriseVO>(enterpriseVO, HttpStatus.OK);
	}
	
	// 관심기업 삭제
	@RequestMapping(value = "/hateEnt.do", method = RequestMethod.POST)
	public ResponseEntity<EnterpriseVO> hateEnt(@RequestBody EnterpriseVO enterpriseVO,
			Model model) {
		
//		log.info(enterpriseVO.toString());
		ServiceResult result = likeService.hateEnt(enterpriseVO);
		String yn = "";
		
		int num = likeService.countLikeEnt(enterpriseVO);
		
		if(result.equals(ServiceResult.OK)) {
			yn = "Y";
		}else {
			yn = "N";
		}
		
		enterpriseVO.setEntHit(num);
		enterpriseVO.setLikeEntYN(yn);
			
		return new ResponseEntity<EnterpriseVO>(enterpriseVO, HttpStatus.OK);
	}
	
	
	// 지원버튼
	@RequestMapping(value = "/apply.do", method = RequestMethod.POST)
	public ResponseEntity<RecruitVO> applyCheck(@RequestBody RecruitVO recruitVO,
			Model model, HttpSession session) {
		
		
		RecruitVO recruit = likeService.applyCheck(recruitVO);
		log.info("!!!!!" + recruit);
		
		
		if(recruit.getProcessYn().equals("Y")) {
			model.addAttribute("recruit", recruit);
		}else {
			model.addAttribute("recruit", recruit);
		}
		
		return new ResponseEntity<RecruitVO>(recruit, HttpStatus.OK);
	}
	
	
	
	// 관심공고 삭제
	@RequestMapping(value = "hateRecruit.do", method = RequestMethod.POST)
	public ResponseEntity<String> hateRecruit(@RequestBody RecruitVO recruitVO,
			Model model) {
		
//			log.info(enterpriseVO.toString());
		ServiceResult result = likeService.hateRecruit(recruitVO);
		String yn = "";
		
		if(result.equals(ServiceResult.OK)) {
			yn = "Y";
		}else {
			yn = "N";
		}
			
		return new ResponseEntity<String>(yn, HttpStatus.OK);
	}
	
	// 관심공고 추가
	@RequestMapping(value = "/loveRecruit.do", method = RequestMethod.POST)
	public ResponseEntity<String> loveRecruit(@RequestBody RecruitVO recruitVO,
			Model model) {
		
//			log.info(enterpriseVO.toString());
		ServiceResult result = likeService.loveRecruit(recruitVO);
		String yn = "";
		
		if(result.equals(ServiceResult.OK)) {
			yn = "Y";
		}else {
			yn = "N";
		}
			
		return new ResponseEntity<String>(yn, HttpStatus.OK);
	}
	
	
	// 관심공고 추가
	@RequestMapping(value = "/count.do", method = RequestMethod.GET)
	public ResponseEntity<Integer> count(@RequestBody EnterpriseVO enterpriseVO,
			Model model) {
		
		int result = likeService.countLikeEnt(enterpriseVO);
		log.info("@@@@@@@@@@@@@@@@@    " + String.valueOf(result));
		
		int num = 0;
		
		if(result > 0) {
			num = result;
		}else {
			num = result;
		}
			
		return new ResponseEntity<Integer>(num, HttpStatus.OK);
	}
	
	
}
