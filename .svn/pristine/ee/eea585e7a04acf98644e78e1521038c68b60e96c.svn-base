<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>


<!-- Page main content START -->
<div class="page-content-wrapper border">

	<!-- Title -->
	<div class="row">
		<div class="col-12">
			<h1 class="h3 mb-2 mb-sm-0">문의게시판</h1>
		</div>
	</div>

	<!-- Card START -->
	<div class="card bg-transparent">

		<!-- Card header START -->
		<div class="card-header bg-transparent border-bottom px-0">
			<!-- Search and select START -->
			<div class="row g-3 align-items-center justify-content-between"></div>
			<!-- Search and select END -->
		</div>

		<div class="card-body px-0">
			<div class="table-responsive border-0">
				<table class="table align-middle p-4 mb-0 table-hover text-center">
					<thead>
						<tr style="background-color: #DCD8FC;">
							<th scope="col" class="border-0 rounded-start" style="color: black;">문의번호</th>
							<th scope="col" class="border-0" style="color: black;">제목</th>
							<th scope="col" class="border-0" style="color: black;">작성일</th>
							<th scope="col" class="border-0" style="color: black;">상태</th>
							<th scope="col" class="border-0" style="color: black;">답변하기</th>
						</tr>

					</thead>

					<tbody>
						<c:set value="${pagingVO.dataList }" var="list" />
						<c:choose>
							<c:when test="${empty list }">
								<tr>
									<td colspan="5">문의글이 없습니다</td>
								</tr>
							</c:when>
							<c:otherwise>
								<c:forEach items="${list }" var="inquiryList">
									<tr>
										<td>${inquiryList.bbsNo }</td>
										<td>${inquiryList.bbsTtl }</td>
										<td><fmt:formatDate value="${inquiryList.bbsRegDt }" pattern="yyyy-MM-dd" /></td>
										<td><c:choose>
												<c:when test="${inquiryList.replyYn eq '답변'}">
													<span style="color: green;">${inquiryList.replyYn}</span>
												</c:when>
												<c:otherwise>
													<span style="color: red;">${inquiryList.replyYn}</span>
												</c:otherwise>
											</c:choose></td>
										<td>
											<c:if test="${inquiryList.replyYn ne '답변'}">
												<a href="#" class="btn btn-secondary-soft mb-0 view-inquiry" data-bbsno="${inquiryList.bbsNo}" data-bbstitle="${inquiryList.bbsTtl}" data-bbscontent="${inquiryList.bbsCn}" data-bs-toggle="modal" data-bs-target="#viewReview">답변하기</a>
											</c:if>
										</td>
									</tr>
								</c:forEach>
							</c:otherwise>
						</c:choose>
					</tbody>

				</table>
			</div>
		</div>
	</div>

	<div class="card-footer bg-transparent p-0">
		<!-- Pagination START -->
		<div class="d-sm-flex justify-content-sm-between align-items-sm-center">
			<!-- Content -->
			<p class="mb-0 text-center text-sm-start"></p>
			<!-- Pagination -->
			<nav class="d-flex justify-content-center mb-0" aria-label="navigation">
				<ul class="pagination pagination-sm pagination-primary-soft d-inline-block d-md-flex rounded mb-0">
					<li class="page-item mb-0"><a class="page-link" href="#" tabindex="-1"><i class="fas fa-angle-left"></i></a></li>
					<li class="page-item mb-0"><a class="page-link" href="#">1</a></li>
					<li class="page-item mb-0 active"><a class="page-link" href="#">2</a></li>
					<li class="page-item mb-0"><a class="page-link" href="#">3</a></li>
					<li class="page-item mb-0"><a class="page-link" href="#"><i class="fas fa-angle-right"></i></a></li>
				</ul>
			</nav>
		</div>
	</div>
</div>

<!-- **************** MAIN CONTENT END **************** -->

<!-- Back to top -->
<div class="back-top">
	<i class="bi bi-arrow-up-short position-absolute top-50 start-50 translate-middle"></i>
</div>

<!-- Popup modal for review START -->
<div class="modal fade" id="viewReview" tabindex="-1" aria-labelledby="viewReviewLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal header -->
			<div class="modal-header bg-purple">
				<h5 class="modal-title text-white" id="viewReviewLabel">답변하기</h5>
				<button type="button" class="btn btn-sm btn-light mb-0" data-bs-dismiss="modal" aria-label="Close">
					<i class="bi bi-x-lg"></i>
				</button>
			</div>
			<!-- Modal body -->
			<form class="insertForm" id="insertForm" method="post" action="/myPage/admin/inquiryAnswerInsert">
				<div class="modal-body">
					<div class="d-md-flex">
						<!-- Text -->
						<div>
							<h5 class="modal-title" id="modalTitle"></h5>
							<input type="hidden" name="bbsNo" id="bbsNo"> <br>
							<p id="modalContent"></p>
							<div class="form-floating">
								<textarea name="bssCmntCn" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"></textarea>
								<label for="floatingTextarea2">답변을 작성해주세요</label>
							</div>
						</div>
					</div>
					<!-- Modal footer -->
					<div class="modal-footer">
						<button type="submit" class="btn btn-danger-soft my-0" data-bs-dismiss="modal">답변 등록</button>
					</div>
				</div>
				<sec:csrfInput />
			</form>
		</div>
	</div>
</div>
<!-- Popup modal for review END -->

<script type="text/javascript">
	// ckeditor에서 내용을 불러올 때 <p> 태그 제거
	function removePTags(content) {
		// ckeditor에서 가져온 내용에서 <p> 태그 제거
		var sanitizedContent = content.replace(/<p>/g, '')
				.replace(/<\/p>/g, '');
		return sanitizedContent;
	}

	// 문의글을 클릭하면 해당 문의의 내용을 모달에 표시
	$(document).on("click", ".view-inquiry", function() {
		// 클릭한 문의의 정보 가져오기
		var bbsNo = $(this).data("bbsno");
		var bbsTitle = $(this).data("bbstitle");
		var bbsContent = $(this).data("bbscontent");

		// ckeditor에서 <p> 태그 제거
		var sanitizedContent = removePTags(bbsContent);

		// 모달 내용 업데이트
		$("#modalTitle").text(bbsTitle);
		$("#modalContent").html(sanitizedContent);

		$("#bbsNo").val(bbsNo);

		// 모달이 표시될 때 textarea의 높이를 수정
		$('#viewReview').on('shown.bs.modal', function() {
			// 원하는 너비와 높이로 설정
			$('#floatingTextarea2').css({
				width : '460px', // 예시로 300px로 설정
				height : '200px' // 예시로 200px로 설정
			});
		});
	});
</script>
