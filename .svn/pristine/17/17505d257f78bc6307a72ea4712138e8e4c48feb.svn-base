<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<main>
	<section class="pt-0">
		<div class="container">
			<div class="row">
				<div class="col-12" style="max-height:350px">
					<!-- Slider START -->
					<div class="tiny-slider arrow-round arrow-blur arrow-hover rounded-2 overflow-hidden">
						<div class="tiny-slider-inner" data-autoplay="false" data-gutter="0" data-arrow="true" data-dots="false" data-items="1">

							<!-- Card item START -->
							<a href="#">
								<div class="card overflow-hidden h-500px h-md-350px text-center rounded-0" style="background-image:url(${pageContext.request.contextPath }/resources/assets/images/main/1.png); background-position: center; background-size: contain; background-repeat: no-repeat; ">
									<!-- Background dark overlay -->
									<!-- Background dark overlay -->
									<!-- <div class="bg-overlay bg-dark opacity-6"></div> -->
									<!-- Card image overlay -->
									<div class="card-img-overlay d-flex align-items-center p-2 p-sm-4"> 
										<div class="w-100 my-auto">
											<div class="row justify-content-center">
												<div class="col-11 col-lg-7">
													<!-- Title -->
													<!-- <h1 class="text-white display-6">Discover Lifelong Learning</h1>
													<p class="text-white">This Bootstrap 5 based theme is ideal for all types of sites that offer education such as Kindergarten, School, College, University, Courses Hub, Training Center, or any Academy.</p> -->
													<!-- Button -->
													<!-- <a href="university-admission-form.html" class="btn btn-primary me-2 mb-0">Admissions</a>
													<a href="#" class="btn btn-outline-white mb-0">Learn More</a> -->
												</div>
											</div>
										</div>
									</div>
								</div>
							</a>	
							<!-- Card item END -->
	
							<!-- Card item START -->
							<a href="#">
								<div class="card overflow-hidden h-500px h-md-350px text-center rounded-0" style="background-image:url(${pageContext.request.contextPath }/resources/assets/images/main/2.png); background-position: center; background-size: contain; background-repeat: no-repeat; ">
									<!-- Background dark overlay -->
									<!-- Background dark overlay -->
									<!-- <div class="bg-overlay bg-dark opacity-6"></div> -->
									<!-- Card image overlay -->
									<div class="card-img-overlay d-flex align-items-center p-2 p-sm-4"> 
										<div class="w-100 my-auto">
											<div class="row justify-content-center">
												<div class="col-11 col-lg-7">
													<!-- Title -->
													<!-- <h1 class="text-white display-6">Discover Lifelong Learning</h1>
													<p class="text-white">This Bootstrap 5 based theme is ideal for all types of sites that offer education such as Kindergarten, School, College, University, Courses Hub, Training Center, or any Academy.</p> -->
													<!-- Button -->
													<!-- <a href="university-admission-form.html" class="btn btn-primary me-2 mb-0">Admissions</a>
													<a href="#" class="btn btn-outline-white mb-0">Learn More</a> -->
												</div>
											</div>
										</div>
									</div>
								</div>
							</a>
							<!-- Card item END -->

							<!-- Card item START -->
							<a href="">
								<div class="card overflow-hidden h-500px h-md-350px text-center rounded-0" style="background-image:url(${pageContext.request.contextPath }/resources/assets/images/main/3.png); background-position: center; background-size: contain; background-repeat: no-repeat; ">
									<!-- Background dark overlay -->
									<!-- Background dark overlay -->
									<!-- <div class="bg-overlay bg-dark opacity-6"></div> -->
									<!-- Card image overlay -->
									<div class="card-img-overlay d-flex align-items-center p-2 p-sm-4"> 
										<div class="w-100 my-auto">
											<div class="row justify-content-center">
												<div class="col-11 col-lg-7">
													<!-- Title -->
													<!-- <h1 class="text-white display-6">Discover Lifelong Learning</h1>
													<p class="text-white">This Bootstrap 5 based theme is ideal for all types of sites that offer education such as Kindergarten, School, College, University, Courses Hub, Training Center, or any Academy.</p> -->
													<!-- Button -->
													<!-- <a href="university-admission-form.html" class="btn btn-primary me-2 mb-0">Admissions</a>
													<a href="#" class="btn btn-outline-white mb-0">Learn More</a> -->
												</div>
											</div>
										</div>
									</div>
								</div>
							</a>
							<!-- Card item END -->
						</div>
					<!-- Slider END -->
					</div>
				</div>
			</div>
		</div>
	</section>



	<!-- =======================추천공고 START -->
	<section style="padding: 0;">
		<div class="container">
			<!-- Title -->
			<div class="row mb-3">
				<!-- <div class="col-lg-8 mx-auto text-center"> -->
					<h3 class="fs-1" >추천공고</h3>
					<br><br>
					<!-- <p class="mb-0">Choose from hundreds of courses from specialist organizations</p> -->
				<!-- </div> -->
			</div>

			<!-- Tabs START -->
			<!-- <ul class="nav nav-pills nav-pills-bg-soft justify-content-sm-center mb-4 px-3" id="course-pills-tab" role="tablist"> -->
				<!-- Tab item -->
				<!-- <li class="nav-item me-2 me-sm-5">
					<button class="nav-link mb-2 mb-md-0 active" id="course-pills-tab-1" data-bs-toggle="pill" data-bs-target="#course-pills-tabs-1" type="button" role="tab" aria-controls="course-pills-tabs-1" aria-selected="false">Web Design</button>
				</li> -->
				<!-- Tab item -->
				<!-- <li class="nav-item me-2 me-sm-5">
					<button class="nav-link mb-2 mb-md-0" id="course-pills-tab-2" data-bs-toggle="pill" data-bs-target="#course-pills-tabs-2" type="button" role="tab" aria-controls="course-pills-tabs-2"	aria-selected="false">Development</button>
				</li> -->
				<!-- Tab item -->
				<!-- <li class="nav-item me-2 me-sm-5">
					<button class="nav-link mb-2 mb-md-0" id="course-pills-tab-3" data-bs-toggle="pill" data-bs-target="#course-pills-tabs-3" type="button" role="tab" aria-controls="course-pills-tabs-3" aria-selected="false">Graphic Design</button>
				</li> -->
				<!-- Tab item -->
				<!-- <li class="nav-item me-2 me-sm-5">
					<button class="nav-link mb-2 mb-md-0" id="course-pills-tab-4" data-bs-toggle="pill" data-bs-target="#course-pills-tabs-4" type="button" role="tab" aria-controls="course-pills-tabs-4" aria-selected="false">Marketing</button>
				</li> -->
				<!-- Tab item -->
				<!-- <li class="nav-item me-2 me-sm-5">
					<button class="nav-link mb-2 mb-md-0" id="course-pills-tab-5" data-bs-toggle="pill" data-bs-target="#course-pills-tabs-5" type="button" role="tab" aria-controls="course-pills-tabs-5"	aria-selected="false">Finance</button>
				</li>
			</ul> -->
			<!-- Tabs END -->

			<!-- Tabs content START -->
			<div class="tab-content" id="course-pills-tabContent">
				<!-- Content START -->
				<div class="tab-pane fade show active" id="course-pills-tabs-1" role="tabpanel" aria-labelledby="course-pills-tab-1">
					<div class="row g-4 cardArea">
					
					<c:choose>
						<c:when test="${empty initRecruitList }">
							<div class="col-sm-6 col-lg-4 col-xl-3">
							<div class="card shadow h-100">
							
								<!-- Image -->
								<img src="${pageContext.request.contextPath }/resources/assets/images/logoITcruitSolid.png" class="card-img-top" alt="course image" style="padding: 10px;">
								
								<!-- Card body -->
								<div class="card-body pb-0">
									<!-- Badge and favorite -->
									<div class="d-flex justify-content-between mb-2">
										<!-- <a href="#" class="badge bg-purple bg-opacity-10 text-purple">All level</a> -->
										
									</div>
									<!-- Title -->
									<a href="#">
									<p class="mb-2 text-truncate-2">정보없음</p>
									<h5 class="card-title fw-normal">정보없음</h5>
									</a>
									<!-- Rating star -->
									<!-- <ul class="list-inline mb-0">
										<li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
										<li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
										<li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
										<li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
										<li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
										<li class="list-inline-item ms-2 h6 fw-light mb-0">4.0/5.0</li>
									</ul> -->
								</div>
								<!-- Card footer -->
								<div class="card-footer pt-0 pb-3">
									<hr>
									<div class="d-flex justify-content-between">
										<span class="h6 fw-light mb-0"><i class="far fa-clock text-danger me-2"></i>정보없음</span>
										<a href="#" class="h6 mb-0"><i class="far fa-heart"></i></a>
									</div>
								</div>
							</div>
						</div>
						</c:when>
						
						<c:otherwise>
						<!-- Card item START -->
						<c:forEach items="${initRecruitList }" var="recruit">
						<div class="col-sm-6 col-lg-4 col-xl-3">
							<div class="card shadow h-100">
								<!-- Image -->
								<img src="/main/logodisplay?entNo=${recruit.entNo }" alt="기업로고" style="display: block; margin: 0 auto; padding: 10px; width: 250px; height: 180px;">
								<!-- Card body -->
								<div class="card-body pb-0">
									<!-- Badge and favorite -->
									<div class="d-flex justify-content-between mb-2">
									</div>
									<!-- Title -->
									<c:choose>
										<c:when test="${fn:startsWith(recruit.recruitEndDt, 'D')}">
											<a class="atag" href="/main/recruitDetail.do?recruitNo=${recruit.recruitNo }&pstnCmmncdNm=${recruit.pstnCmmncdNm}">
												<p class="mb-2 text-truncate-2">${recruit.entNm }</p>
												<h5 class="card-title fw-normal">${recruit.recruitTtl }</h5>
											</a>
										</c:when>
										<c:otherwise>
											<a class="atagDone" href="">
												<p class="mb-2 text-truncate-2">${recruit.entNm }</p>
												<h5 class="card-title fw-normal">${recruit.recruitTtl }</h5>
											</a>
										</c:otherwise>
									</c:choose>
									
									
								</div>
								<!-- Card footer -->
								<div class="card-footer pt-0 pb-3">
									<hr>
									<div class="d-flex justify-content-between">
										<span class="h6 fw-light mb-0 endDate"> <c:if test="${fn:startsWith(recruit.recruitEndDt, 'D')}"><i class="far fa-clock text-danger me-2"></i></c:if> 
										<font <c:if test="${fn:startsWith(recruit.recruitEndDt, '공고')}">color="lightgray"</c:if>>${recruit.recruitEndDt }</font></span>
										<a href="#" class="h6 mb-0"><i class="far fa-heart"></i></a>
									</div>
								</div>
							</div>
						</div>
						</c:forEach>
						</c:otherwise>
					</c:choose>
						<!-- Card item END -->
						
					</div> <!-- Row END -->
				</div>
				<!-- Content END -->
			</div>
		</div>
	</section>
	<sec:csrfInput/>
</main>
<script type="text/javascript">
$(document).ready(function() {
	
	$(".g-4").on("click", ".atagDone", function(event){
		event.preventDefault();
		alert("이미 마감된 공고입니다!");
	});
 
    var slider = tns({
        container: '.tiny-slider-inner',
        items: 1,
        autoplay: true,
        autoplayTimeout: 5000, // 5초
        autoplayButtonOutput: false,
        controls: false,
        nav: false
    });
    
    let isFetching = false; // 리스트를 가져오는 중인지 여부를 나타내는 변수
    let isEnd = false; // 더 이상 리스트를 가져올 필요가 없는지 여부를 나타내는 변수

    // 스크롤 이벤트 핸들러
    function handleScroll() {
        if (!isFetching && !isEnd) {
            let $window = $(window);
            let scrollTop = $window.scrollTop();
            let windowHeight = $window.height();
            let documentHeight = $(document).height();
            
            // scrollbar의 thumb가 바닥 전 30px까지 도달 하면 리스트를 가져온다.
            if (scrollTop + windowHeight + 80 > documentHeight) {
//                 console.log("!!!");
                fetchList();
            }
        }
    }

    // 페이지 로드 시 스크롤 이벤트 발생 시켜 리스트를 가져온다.
    $(window).trigger('scroll');

    // 스크롤 이벤트 리스너 등록
    $(window).scroll(handleScroll);

    // 리스트 가져오는 함수
    function fetchList() {
        if (isEnd || isFetching) {
            return;
        }
        
        // 리스트를 가져오는 중임을 표시
        isFetching = true;

        // 현재 화면에 표시된 리스트 개수
        let currentListSize = $("#course-pills-tabs-1 .card").length;
        
        let currentPage = Math.ceil(currentListSize / 20) + 1; // 다음 페이지 계산
        
        $.ajax({
            url: "/main/paginationInfo?currentPage="+currentPage,
            type: "POST",
            contentType : "application/json; charset=utf-8",
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function(response) {
                let initRecruitList = response;
                console.log(initRecruitList);
                
                if (initRecruitList.length === 0) {
                    isEnd = true; // 더 이상 데이터가 없으면 isEnd를 true로 설정
                    return;
                }
                
                // initRecruitList 배열의 각 요소에 접근하여 카드 HTML을 생성
                let cardHTML = "";
                for (let i = 0; i < initRecruitList.length; i++) {
                    let recruit = initRecruitList[i];
                    
                    // 카드 HTML 문자열 구성
                    cardHTML += '<div class="col-sm-6 col-lg-4 col-xl-3">' +
                        '<div class="card shadow h-100">' +
                            '<img src="/main/logodisplay?entNo=' + recruit.entNo + '" alt="기업로고" style="display: block; margin: 0 auto; padding: 10px; width: 250px; height: 180px;">' +
                            '<div class="card-body pb-0">' +
                                '<div class="d-flex justify-content-between mb-2">' +
                                '</div>' +
                                '<a href="/main/recruitDetail.do?recruitNo=' + recruit.recruitNo + '&pstnCmmncdNm=' + recruit.pstnCmmncdNm + '" class="atag">' +
                                    '<p class="mb-2 text-truncate-2">' + recruit.entNm + '</p>' +
                                    '<h5 class="card-title fw-normal">' + recruit.recruitTtl + '</h5>' +
                                '</a>' +
                            '</div>' +
                            '<div class="card-footer pt-0 pb-3">' +
                                '<hr>' +
                                '<div class="d-flex justify-content-between">' +
                                    '<span class="h6 fw-light mb-0 endDate">' +
                                        '<i class="far fa-clock text-danger me-2"></i>' +
                                        recruit.recruitEndDt +
                                    '</span>' +
                                    '<a href="#" class="h6 mb-0"><i class="far fa-heart"></i></a>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                }
                
                // 생성된 카드 HTML을 삽입
                $(".cardArea").append(cardHTML);

                // 리스트 가져오기가 완료되었으므로 isFetching 상태 변경
                isFetching = false;
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error("Error fetching pagination info: " + errorThrown);
                // 리스트 가져오기가 실패했으므로 isFetching 상태 변경
                isFetching = false;
            }
        });
    }
    
});






</script>